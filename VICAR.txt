SOFTWARE ORGANIZATION

The vicar project source is in Server which contains Global.java, Error.html and 6 subdirectories.  Global.java contains general settings specific to an installation.
Error.html is the default page for all errors as listed at the end of sitemap.xmap.

Core implements the body of the website mainly through FileManager.java.

These files are actually stored in /tmp/vicar/[slight_munge_of_user_email_address]/[collection_name_given_by_user]/ with two subdirectories; input and output.  FileManager calls on FileUpload to implement a simple utility for uploading a single file at a time.  FileDownload allows download of a single file at a time.  ZipUtil contains the utilies for FileManager to unzip/zip, ungzip/gzip, and untar/tar data files.

OpenSignin enables the use of a user's Yahoo or Google ID for Signin. (For more information on OpenID, visit http://openid.net.)
Vicar's OpenSignin access uses the JOpenID library JOpenId-1.08.jar from http://code.google.com/p/jopenid/.  There are several others to choose from at http://openid.net/developers/libraries/ but this one seemed to be the easiest with which to get started, especially within a servlet or cocoon generator.  OpenSignin.java is based on some of their sample code.

Modernizr contains only modernizr.js which is used for detection of browser capabilities.  More information can be found at http://modernizr.com.

Progress contains the source code for implementing progress bars for file upload and Abbot conversion (future).

Upload contains the source code for implementing multiple uploads via Ajax.

Utils contains utilities for general Ajax implementations as used by software in Upload and Progress.



COCOON INSTALL 

Vicar is built as a cocoon.2.11 server application.  For more information about cocoon.2.11 and installation instructions visit http://cocoon.apache.org/2.1/installing/index.html

A. Download vicar from https://github.com/CDRH/vicar.

B. SET UP DIRECTORIES AND EDIT build.xml

To install vicar on your local cocoon server you will need to create one directory for the vicar software and locate 3 others.  You will need to declare these directories in build.xml as builddir, libdir, and corelibdir.  builddir is where ant will place the compiled .class files.  libdir is where cocoon will look for various jar files which are part of cocoon.  corelibdir is the path to core jar files which are found as part of tomcat in a tomcat based cocoon install, or as part of cocoon in a jetty based install.  (If you start your cocoon server 

If you have a jetty install (install which is started with the cocoon.sh command), these 3 directories will be found in your cocoon install's subdirectory build/webapp/WEB-INF/ (classes, lib, and lib/core, respectively).a  If you have a tomcat install, the first 2 directories will be in the cocoon directory which was created by the unpacking of the cocoon.war file.   For tomcat 7, this is in /var/lib/tomcat-7/webapps/webapp/.  The third directory will be part of the tomcat install.  For tomcat 7, this is in /usr/share/tomcat-7/.  Earlier versions of tomcat may have a different directory arrangement.


C. UPLOAD JAR FILES 

The directory 'libdir' will need the addition of several jar files.
	- JOpenId-1.08.jar which can be downloaded from http://code.google.com/p/jopenid/.  This jar gives the ability to accept openid login from OpenSignin/OpenSignin.java.
	- abbot-0.4.3.jar which implements abbot and it's java API.  This file can be found at https://github.com/CDRH/abbot/downloads.
	- commons-compress-1.3.jar which can be downloaded from http://commons.apache.org/compress/.  This jar enables the unpacking and packing of tar files used in Core/ZipUtil.java.
	- junit-4.10.jar which is needed for junit testing (for build.xml's junit target).  junit-4.10.jar can be found at https://github.com/KentBeck/junit/downloads.  (This jar should probably be put outside of the cocoon directories but for the sake of uniform structure between my local install and that on abbot, it is currently in the libdir.  This is in part because there is already a junit.jar in /usr/share/junit/lib/ on abbot which appears to be an older version or otherwise incompatible.  It does not contain the org.junit packages.)
	- Additionally vicar will need a jar to implement Jing validation software.  Cocoon should come with an existing jing-20030619.jar.  If it is not available then that or a more recent jing jar can be found at http://www.thaiopensource.com/relaxng/jing.html. 	


D. EDIT VICAR

You will also need to edit Global.java to reflect the current installation.
	- URL_BASE is the base url at which vicar will be located.  If you are running it on your own computer that should likely be http://127.0.0.1:8888 for a jetty install and http://127.0.0.1:8080 for a tomcat install.
	- BASE_USER_DIR is the directory that will contain all user data.  Verify that this directory can be written to by vicar.
	- SCHEMA_DIR is where the system provided schema files reside. 
	- SED_PATH is where the unix sed command resides.  This is used for modifying information in abbot generated files.


E. COMPILE

Compile using ant.  Compilation of vicar is the default action of the build.xml file.


F. DECLARE TO COCOON

Create and entry in your cocoon server's sitemap.xmap file (in [cocoon_install]/build/webapp/ for jetty installs or in [tomcat_install]/webapps/cocoon/ for tomcat installs) will need a <map:pipeline> entry for the files in your created directory.  Something like;

        <map:match pattern="vicar/**">
                <map:mount check-reload="yes"
                                src="[your_home_dir]/vicar/"
                                uri-prefix="vicar" />
        </map:match>

This lets cocoon find your vicar specific sitemap.xmap and vicar's .xsl files.

(I don't have tomcat 6 installed and am basing my info on abbot's tomcat 7 install.  Tomcat 7 may vary in directory structure from tomcat 6.)


G. TEST
View vicar in your browser either at http://127.0.0.1:8888/cocoon/vicar/Core/FileManager.html for a jetty install or http://127.0.0.1:8080/cocoon/vicar/Core/FileManager.html for a tomcat install.


OPERATION

The July update of vicar lets a user upload input .xml files and .rng schema files.  A user can then convert the input files using Abbot based on provided schemas or the user supplied schemas.  The resulting files can be validated against the schemas and downloaded.

Vicar is running on abbot at http://abbot.unl.edu:8080/cocoon/vicar/Core/FileManager.html

******

'Use Abbot' will take you to a page to display your uploaded collections.  To create a collection, click on 'Create New Collection.'  You will be asked to enter a collection name.  Enter any name containing only letters a-z and A-Z with no spaces (for now, this could be made more flexible in the future) and press Save.  You will then be asked to add files to this collection.  Click browse, select the xml files, and press Upload.  Schema files can also be uploaded.  These will appear on the schema list in black text after the list of provided schemas.

You can also upload a zip file containing multiple xml files.  You will be presented with an 'unzip' link.  Click on the link and the contents of the zip file will then show in this collection.

You can click on 'Collections' to go to your list of collections.  You can click on a collection name to see its contents.  Click on a collection's red X to delete the collection and the files.

Once you have files in your collection you will see 3 green 'greater than' arrows.  Click on the arrows to invoke abbot.  Abbot will populate an output directory with the result of it's run. 
If there are multiple files in the output, you will be given an option to package them into a single zip file.  Clicking on an individual xml file send it to your browser.  Use Ctrl click to 'Save Link As' and download the output file.  Clicking on the zip file should automaticall y give you an option to save the zip file.

Each file will, to it's right, have a green 'ok' in a green outline or a red number in a red outline.  This is the result of schema validation.  The red number is the number of errors found by the validation software.

The files are stored on abbot in /tmp/vicar/[slight_munge_of_your_email_addr]/[collection_name]/.  This path contains an input, schema, valid, and output directory.

Input files for now should not exceed 15MB.

DOCUMENT UPDATED July 16, 2012
